#include "xparameters.h"
#include "xuartlite.h"
#include "xil_printf.h"
#include "xuartlite_l.h"
#define UART_DEVICE_ID XPAR_UARTLITE_0_DEVICE_ID

XUartLite Uart;

int main() {
    xil_printf("=== UART 16-bit Receiver ===\r\n");

    XUartLite_Initialize(&Uart, UART_DEVICE_ID);

    while (1) {
        // 檢查是否有兩筆資料（2 bytes）可以讀
        if (!XUartLite_IsReceiveEmpty(Uart.RegBaseAddress)) {
            u8 low = XUartLite_RecvByte(Uart.RegBaseAddress);

            while (XUartLite_IsReceiveEmpty(Uart.RegBaseAddress));  // 等第二筆
            u8 high = XUartLite_RecvByte(Uart.RegBaseAddress);

            u16 value = ((u16)high << 8) | low;

            xil_printf("Received 16-bit value: 0x%04X (%d)\r\n", value, value);

            // ✅ 範例驗證條件（假設對方傳的是 0x1234）
            if (value == 0x1234) {
                xil_printf("✅ Data matches expected value.\r\n");
            } else {
                xil_printf("❌ Mismatch: expected 0x1234\r\n");
            }
        }
    }

    return 0;
}
